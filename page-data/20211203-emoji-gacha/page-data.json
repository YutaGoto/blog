{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/20211203-emoji-gacha/",
    "result": {"data":{"site":{"siteMetadata":{"title":".ごっちの日記","siteUrl":"https://yutagoto.github.io"}},"markdownRemark":{"id":"71eaacb2-754d-550b-9db1-81f84d230254","excerpt":"この記事は雑談 Slack Advent Calendar 2021 の 23 日目の記事です。 こんにちは、.ごっちです。\n毎年雑談 Slack アドベントカレンダーで Slack emoji について取り上げているような気がしていますが、今年も取り上げます。 2020: emojicode CircleCI…","html":"<p>この記事は<a href=\"https://adventar.org/calendars/6233\">雑談 Slack Advent Calendar 2021</a> の 23 日目の記事です。</p>\n<p>こんにちは、.ごっちです。\n毎年雑談 Slack アドベントカレンダーで Slack emoji について取り上げているような気がしていますが、今年も取り上げます。</p>\n<ul>\n<li><a href=\"https://dev.to/yutagoto/emojicode-circleci-5egn\">2020: emojicode CircleCI</a></li>\n<li><a href=\"https://dev.to/yutagoto/emojicode-fizzbuzz-4akl\">2019: emojicode FizzBuzz</a></li>\n<li><a href=\"https://medium.com/@gggooottto/emoji%E3%81%A7%E3%81%84%E3%81%A3%E3%81%B1%E3%81%84-a8f63d02ebb1\">2018: Emoji でいっぱい</a></li>\n<li><a href=\"https://medium.com/@gggooottto/emoji%E3%81%A7%E3%81%84%E3%81%A3%E3%81%B1%E3%81%84-f5bcca95c24\">2017: Emoji でいっぱい</a></li>\n</ul>\n<p>SlackSlashCommand を送信したら、ランダムに絵文字を返してくれる機能を試しに作りました。</p>\n<h2>Slack アプリの登録</h2>\n<p><a href=\"https://api.slack.com/authentication/basics\">公式のドキュメント</a>を見ながら作成します。</p>\n<p><a href=\"https://api.slack.com/apps\">https://api.slack.com/apps</a> にアクセスして、 <code class=\"language-text\">Create New App</code> から <code class=\"language-text\">From Scratch</code> を選択して登録します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0f4b709c7095051284d1c264f9a7e031/e04e6/app1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVQoz5VTS4vaYBSNz5/myo34S7orioLgYmbQH9F2YyE60oHCFLpoi5suixgdqKNORuMjD03yJSYxp9xbM/RBYXrhkI8v5557DjeRZot7jEYjHA4H/FpxHP+GpE6nE4QQOB6PiMIAISNEFIYIggDSwbKgGwYcx4HneUwk0EtqJjE6J/cE3/chPB+Oe4QQR7iegCME30tMCgJsdBPz+Ry6rrOApmkYj8dQFAWu6zKZBhKE8PB94eHmY4y3X2Z4efsKL25e4+vsDhKTfB9zdQllNIJpmuyCnuv1GsvlEpZlYb/fw7ZtFqc0B9uBZQnszD0edmuouw0s24bknwUftQ1UVWUxGkKOKPL/FPU+CS4eNQyHQ3ZCgqf4BOVujEajgXa7jVarhavLK1SrVTSbTVxcXKJSqaBWq6Fer6Pf74NWJ/l+4nCL7XbLzigWVe9ahiRJz0KhUOCeJ8H7hyUmkwlcV0AIl6e9kW+RTqeRzWYZmUzmL+TzeRYsl8tnwXNkVdtgOp3yIkiQ6v2nb0xOpVL/RC6XY06pVPopmCzAME2sViveYBL53YfPz45cLBaTyD7IpWEY/FnQpuhPiKII2noDWZbR7XYZdP4TvV4PnU4Hg8GAe34AVV+57KF+alYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app 1\"\n        title=\"slack app 1\"\n        src=\"/blog/static/0f4b709c7095051284d1c264f9a7e031/f058b/app1.png\"\n        srcset=\"/blog/static/0f4b709c7095051284d1c264f9a7e031/c26ae/app1.png 158w,\n/blog/static/0f4b709c7095051284d1c264f9a7e031/6bdcf/app1.png 315w,\n/blog/static/0f4b709c7095051284d1c264f9a7e031/f058b/app1.png 630w,\n/blog/static/0f4b709c7095051284d1c264f9a7e031/40601/app1.png 945w,\n/blog/static/0f4b709c7095051284d1c264f9a7e031/78612/app1.png 1260w,\n/blog/static/0f4b709c7095051284d1c264f9a7e031/e04e6/app1.png 2152w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/218a4/app2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQ4y52T626CQBCFef9Xa038Y2Ks4WogeAMUFkVgmm/skq2xNe0mJ2cdd2fPnBm8sizleDxKnudyOBx0D18uF7ler8qP+2do21bZ42DgB/L+9i6LxUIxm83kr4tkLI/M4Hw+S9M0Cvan00mauhEqqKpK6rrWmP0PBkVR6B3WOI73hATKopwOUzYH2VsbSEqMByyD/X6v96aExhj1B5C873v575oUhmEo64+1LJdLiaJIywMoh6uympShGrWogodhmKAeonC73UqSJLLb7SQIAn0gSzNJ01TjlPwsITFUgaEfvjeFQzCKTGOEh8xXg16V6cKjLHxDsg12XaexbvzdM/fOlFA9DEJZrVbqIXM4n8/F931Z54VUTatK6/rup50K2FU5echAZlkmcRRLHMfK+LbZbCSJYwWjgX/uKMGuUjsd2hRexHh3eG2X3Yuv/NOSb7ebeuZ+j/zWphgzlWkfpnnM7E/LozTUUZYLRsjiMfZ41sUnWaw5KdLCEHcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app 2\"\n        title=\"slack app 2\"\n        src=\"/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/f058b/app2.png\"\n        srcset=\"/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/c26ae/app2.png 158w,\n/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/6bdcf/app2.png 315w,\n/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/f058b/app2.png 630w,\n/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/40601/app2.png 945w,\n/blog/static/e7bf29d46883f3cd5984f8e9bd61e624/218a4/app2.png 1052w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/bb2fd/app3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.40506329113923%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQ4y5VU2Y7aQBD0/7/xziPXCx+RVVaCJRtuhBTuw2CbQwZz2cYVVSfttXdZZTNSabo9np7q6p4xLMtCo95ArVZD7eUFlUoF9Z91VKtVvP54lbXn7894+vaEbrcLjiiKYnAEQSAz1w3HceTD8XiEd/RwvVzF931fQJs4n8/iPxr3+13mTqcDY71egyyHwyFM04x/UAa0H/lJKMN2uw2DwZQ2GVyvV9xut1RKSSaPEIahrDebTRi2ZeNyucB1XZxOJ8HhcBAJmCZtz/PE56H/ZGjbtjDiJgZLzmoTDKhMPtNQAlJDFma1WmE2m2E6nYKHzOdzjEYjmEsTy+USk8lEDqAMDJxM9wNDLpAB9eMmpqmnvh/JllGNtfpxUfiBAQnVjLoqeJCCPiUi1KckqYAMxLT3+71gt9sJttutfGcWnBWbzSb+nwFZvFTK1IEf9cQkE9XpUatoyjrHAblZW4Xtw5R1/spI3RRt7ORpyZvxvqIKPwhiO/hblFarBYPtQq0Wi4W0x3g8lnYZ/BpgMBj8aSPLlvX1agXTcjBzXCw2LsztAcuti7mzx8UP0WjU3xjKQ+AH8YMgj8PNT/l6U0LeDrIj8ygS++3q2bY4j4RPgumzSLwIrDKLyAx6vR5azaZoLs8Xjf8ZDKpXkEVj67CFOPr9PoxsNotSqYRcLvclFItFFAoF5PN5sbmXKJfLyGQy+A1cGFgFGIXNvAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app 3\"\n        title=\"slack app 3\"\n        src=\"/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/f058b/app3.png\"\n        srcset=\"/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/c26ae/app3.png 158w,\n/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/6bdcf/app3.png 315w,\n/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/f058b/app3.png 630w,\n/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/40601/app3.png 945w,\n/blog/static/c5cb04a05fd474dd08b7d936d5efef4f/bb2fd/app3.png 1058w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>登録し終えたら <code class=\"language-text\">App Manifest</code> を編集します。\n今回は <code class=\"language-text\">botの有効化</code>, <code class=\"language-text\">emojiの取得</code>, <code class=\"language-text\">slash commands</code>, <code class=\"language-text\">チャットの書き込み</code> ができるようにします。</p>\n<p>また、同じ Manifest で slash コマンドの登録もできるので合わせて設定します。\nManifest の詳しい仕様は<a href=\"https://api.slack.com/reference/manifests\">公式ドキュメント</a>を見たほうが早いです。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">_metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">major_version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">minor_version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n<span class=\"token key atrule\">display_information</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> emoji<span class=\"token punctuation\">-</span>sample\n<span class=\"token key atrule\">features</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">bot_user</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">display_name</span><span class=\"token punctuation\">:</span> emoji<span class=\"token punctuation\">-</span>sample <span class=\"token comment\"># slackに表示するbotの名前</span>\n    <span class=\"token key atrule\">always_online</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">slash_commands</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> /emojigacha <span class=\"token comment\"># コマンド名</span>\n      <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ngrokを使ってデバッグすると楽</span>\n      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> emoji gacha\n      <span class=\"token key atrule\">usage_hint</span><span class=\"token punctuation\">:</span> /emojigacha\n      <span class=\"token key atrule\">should_escape</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">oauth_config</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">scopes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">bot</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> chat<span class=\"token punctuation\">:</span>write\n      <span class=\"token punctuation\">-</span> emoji<span class=\"token punctuation\">:</span>read\n      <span class=\"token punctuation\">-</span> commands\n<span class=\"token key atrule\">settings</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">org_deploy_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">socket_mode_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">token_rotation_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<p>ここまでできたらインストールしたい Slack のワークスペースにインストールします。\nインストールできたら <code class=\"language-text\">OAuth &amp; Permissions</code> ページに移動して、 <code class=\"language-text\">Bot User OAuth Token</code> を取得します。</p>\n<p>また、 <code class=\"language-text\">Basic Information</code> ページにある <code class=\"language-text\">Verification Token</code> も取得しておきます。\nここまでできたら Slack 側の準備完了です。</p>\n<h2>コード</h2>\n<p>Slash コマンドが実行されたときの処理を書きます。 今回は <code class=\"language-text\">Python</code>, <code class=\"language-text\">flask</code>, <code class=\"language-text\">slack_sdk</code> を使います。</p>\n<ul>\n<li><a href=\"https://palletsprojects.com/p/flask/\">https://palletsprojects.com/p/flask/</a></li>\n<li><a href=\"https://slack.dev/python-slack-sdk/\">https://slack.dev/python-slack-sdk/</a></li>\n</ul>\n<p>プロジェクトのコードは GitHub にあげていますので、それも見てください。</p>\n<p><a href=\"https://github.com/YutaGoto/emoji-gacha\">https://github.com/YutaGoto/emoji-gacha</a></p>\n<p>12 行目にある if 文は、本当に slack の slash コマンドから POST されたものかのチェックをするための分岐です。</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/emoji-gacha'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">emoji_gacha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>form<span class=\"token punctuation\">[</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> config<span class=\"token punctuation\">.</span>VERIFICATION_TOKEN<span class=\"token punctuation\">:</span></code></pre></div>\n<p>13 行目にある <code class=\"language-text\">emoji_list()</code> で絵文字一覧を取得します。 仮に emoji 以外になにか取得する場合にもそれぞれメソッドが用意されているので、かなり便利に使用できます。ただ、使用する場合はそれに応じた manifest の編集が必要です。</p>\n<p><a href=\"https://api.slack.com/methods\">https://api.slack.com/methods</a></p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\">res <span class=\"token operator\">=</span> slack_client<span class=\"token punctuation\">.</span>emoji_list<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>動作確認</h2>\n<p>開発環境での検証は <code class=\"language-text\">ngrok</code> を使うと楽です。詳しくは書きません。</p>\n<p><a href=\"https://ngrok.com/\">https://ngrok.com/</a></p>\n<p>flask サーバーを起動して ngrok を起動して、その URL を manifest に書き込んだらテストをします。\n以下のように slack 上で slash コマンドを入力できて、BOT がワークスペースに登録された emoji を 1 つだけチャットしたかと思います。</p>\n<p><img src=\"/blog/22ed3a8a8a4885c3b241548f6292a09d/slack.gif\" alt=\"slack gif\"></p>\n<p>AWS lambda などにデプロイすれば、いつでも emoji ガチャを回すことができます！</p>","fields":{"slug":"/20211203-emoji-gacha/"},"frontmatter":{"title":"Slackに登録されているemojiでガチャする","date":"December 03, 2021","description":"えもじがちゃ"}},"previous":{"fields":{"slug":"/20211009-ringfitadv-round3/"},"frontmatter":{"title":"リングフィットアドベンチャー 3周目完走したので感想"}},"next":null},"pageContext":{"id":"71eaacb2-754d-550b-9db1-81f84d230254","previousPostId":"2eb15faa-f760-5b59-bc98-8223414c2d3d","nextPostId":null}},
    "staticQueryHashes": ["2137539840","2201837728"]}