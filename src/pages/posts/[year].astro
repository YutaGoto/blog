---
import { getCollection } from "astro:content"

import ArticleCard from "@/components/ArticleCard.astro"
import Bio from "@/components/Bio.astro"
import Heading from "@/components/global/Heading.astro"
import Head from "@/components/Head.astro"
import Layout from "@/components/Layout.astro"
import Years from "@/components/Years.astro"

const { year } = Astro.params

export const getStaticPaths = async () => {
  const allPosts = await getCollection("posts")

  const years = Array.from(
    new Set(allPosts.map((post) => new Date(post.data.date).getFullYear())),
  )
  return years.map((year) => ({ params: { year: year.toString() } }))
}

const allPosts = await getCollection("posts")
const tags = [...new Set(allPosts.flatMap((post) => post.data?.tags))].filter(
  (e): e is string => typeof e === "string",
)
const posts = allPosts.filter(
  (post) => new Date(post.data.date).getFullYear().toString() === year,
)
---

<html>
  <Head
    title={`Posts from ${year}`}
    ogTitle={`Posts from ${year}`}
    ogDescription={`All posts from ${year}`}
  />
  <body>
    <Layout>
      <Heading level={1} className="mb-2 text-4xl font-extrabold">
        <i class="ri-calendar-line"></i>
        {year}年の記事一覧
      </Heading>
      <div class="lg:flex lg:space-x-2">
        <div class="max-w-screen-2xl lg:flex-grow">
          {
            posts.map(post => {
              return <ArticleCard post={post} />
            })
          }
        </div>
        <div class="mb-2 lg:flex-none">
          <Bio />
          <Years />
        </div>
      </div>
    </Layout>
  </body>
</html>
