{"componentChunkName":"component---src-templates-blog-post-js","path":"/20170521-docker-compose-で-python-を動かすの巻/","result":{"data":{"site":{"siteMetadata":{"title":".ごっちの日記","siteUrl":"https://yutagoto.github.io"}},"markdownRemark":{"id":"9deeb478-bcbe-53cf-bff9-0e2a2f25c8bd","excerpt":"どうもこんにちは、ごっちです。 Django の勉強も進めているのですが、その前にシンプルな Python でも動かしたいなと思って、この記事を投稿。 今回は Docker の公式にならって進めます。 ファイルの準備 Dockerfile requirements.txt docker-compose.yml app…","html":"<p>どうもこんにちは、ごっちです。</p>\n<p>Django の勉強も進めているのですが、その前にシンプルな Python でも動かしたいなと思って、この記事を投稿。</p>\n<p>今回は Docker の公式にならって進めます。</p>\n<h2>ファイルの準備</h2>\n<ul>\n<li>Dockerfile</li>\n<li>requirements.txt</li>\n<li>docker-compose.yml</li>\n<li>app.py</li>\n</ul>\n<h2>app.py</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">from flask import Flask\nfrom redis import Redis\n\napp = Flask(__name__)\nredis = Redis(host=&#39;redis&#39;, port=6379)\n\n@app.route(&#39;/&#39;)\n\ndef hello():\n\tcount = redis.incr(&#39;hits&#39;)\n\treturn &#39;Hello from Docker! I have been seen {} times.\\n&#39;.format(count)\n\nif __name__ == &#39;__main__&#39;:\n\tapp.run(host=&#39;0.0.0.0&#39;, debug=True)</code></pre></div>\n<h2>requirements.txt</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">flask\nredis</code></pre></div>\n<h2>Dockerfile</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM python:3.6.1-alpine\nADD . /code\nWORKDIR /code\nRUN pip install -r requirements.txt\nCMD [&quot;python&quot;, &quot;app.py&quot;]</code></pre></div>\n<h2>docker-compose.yml</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: &#39;2&#39;\nservices:\n  web:\n    build: .\n    ports:\n     - &quot;5000:5000&quot;\n    volumes:\n     - .:/code\n  redis:\n    image: &quot;redis:alpine&quot;</code></pre></div>\n<h2>サーバーの起動</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker-compose up\nCreating network &quot;pythondocker_default&quot; with the default driver\nBuilding web\nStep 1/5 : FROM python:3.6.1-alpine\n3.6.1-alpine: Pulling from library/python\n79650cf9cc01: Pull complete\n581a2604819e: Pull complete\nada98fe44e3a: Pull complete\n70b4de28adfd: Pull complete\nbcd83fe4359e: Pull complete\n...\nredis_1  | 1:C 21 May 08:05:21.279 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf\n...\nredis_1  | 1:M 21 May 08:05:21.283 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\nredis_1  | 1:M 21 May 08:05:21.283 # Server started, Redis version 3.2.9\nredis_1  | 1:M 21 May 08:05:21.283 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\nredis_1  | 1:M 21 May 08:05:21.283 * The server is now ready to accept connections on port 6379\nweb_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)\nweb_1    |  * Restarting with stat\nweb_1    |  * Debugger is active!\nweb_1    |  * Debugger PIN: 132-463-211</code></pre></div>\n<p>ここで <a href=\"http://localhost:5000\">http://localhost:5000</a> にアクセスすると、、、</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2044/0*nu6aDtYDJs5WCAP5.PNG\"></p>\n<p>まぁ至ってシンプルなテキストが表示されるかと。。。</p>\n<h2>そもそも</h2>\n<p>Docker Compose って Web サーバーと化さなくても動くもんだよね、たしか。。（勉強しておきます。）</p>\n<p>Django のチュートリアルが一通り終わったらそっちのほうに手を出してみよ。</p>\n<h2>References</h2>\n<ul>\n<li>Get started with Docker Compose, <a href=\"https://docs.docker.com/compose/gettingstarted/\">https://docs.docker.com/compose/gettingstarted/</a></li>\n<li>YutaGoto/python<em>web</em>docker, <a href=\"https://github.com/YutaGoto/python_web_docker\">https://github.com/YutaGoto/python<em>web</em>docker</a></li>\n</ul>\n<p><em>Originally published at <a href=\"https://gist.github.com/YutaGoto/e76424c77b1c4091683811e92e797c7f\">gist.github.com</a>.</em></p>","fields":{"slug":"/20170521-docker-compose-で-python-を動かすの巻/"},"frontmatter":{"title":"Docker Compose で Python を動かすの巻","date":"May 21, 2017","description":"Docker Compose で Python を動かすの巻"}},"previous":{"fields":{"slug":"/20170519-docker-compose-で-django-プロジェクトを作ってみる/"},"frontmatter":{"title":"Docker Compose で Django プロジェクトを作ってみる"}},"next":{"fields":{"slug":"/20170531-django-を使って作っていく-その1/"},"frontmatter":{"title":"Django を使って作っていく その1"}}},"pageContext":{"id":"9deeb478-bcbe-53cf-bff9-0e2a2f25c8bd","previousPostId":"39bbe626-c561-5926-b685-10dd422a6572","nextPostId":"0252899d-ba18-5e83-b4eb-bc96f11eb27d"}},"staticQueryHashes":["2137539840","2201837728"]}