{"componentChunkName":"component---src-templates-blog-post-js","path":"/20190104-今日誕生日のアイドルを取得するcircleci-orbに-slack通知機能を追加したお話/","result":{"data":{"site":{"siteMetadata":{"title":".ごっちの日記"}},"markdownRemark":{"id":"4e8658e9-8041-51dc-9a76-0a7757be0c68","excerpt":"こんにちは、 .ごっちです。 正月休み。せっかくだしなんか作るかぁと思い立って、少し前のアイマスハッカソンで作った CircleCI Orb の追加機能を実装しました。\n今日誕生日のアイドルを出力する CircleCI orb をつくったお話\nこんにちは、 .ごっちです。medium.com 出力結果が CI…","html":"<p>こんにちは、 .ごっちです。</p>\n<p>正月休み。せっかくだしなんか作るかぁと思い立って、少し前のアイマスハッカソンで作った CircleCI Orb の追加機能を実装しました。\n<a href=\"https://medium.com/@gggooottto/%E4%BB%8A%E6%97%A5%E8%AA%95%E7%94%9F%E6%97%A5%E3%81%AE%E3%82%A2%E3%82%A4%E3%83%89%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8Bcircleci-orb%E3%82%92%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%9F%E3%81%8A%E8%A9%B1-fff413118a40\"><strong>今日誕生日のアイドルを出力する CircleCI orb をつくったお話</strong>\n<em>こんにちは、 .ごっちです。</em>medium.com</a></p>\n<p>出力結果が CI ページ上だけだと確認されない可能性が高いので、Slack に通知が行くようにしました。</p>\n<p>—</p>\n<p>CircleCI Orbs に公開したもの ↓ v0.2.1</p>\n<p><a href=\"https://circleci.com/orbs/registry/orb/yutagoto/todays-imas-idol\">https://circleci.com/orbs/registry/orb/yutagoto/todays-imas-idol</a></p>\n<p>リポジトリ ↓\n<a href=\"https://github.com/YutaGoto/todays-imas-idol-orb\"><strong>YutaGoto/todays-imas-idol-orb</strong>\n<em>Contribute to YutaGoto/todays-imas-idol-orb development by creating an account on GitHub.</em>github.com</a></p>\n<p>—</p>\n<h2>ざっとコードをみてみる</h2>\n<iframe src=\"https://medium.com/media/564dfc62cfbd0541617a7f488b35983a\" frameborder=0></iframe>\n<p>だいぶ長くなりましたが、追加した部分は slack-notification-todays-imas-idol: を追加しただけです。それ以外は特段変わっていないです。</p>\n<p>ざっと解読すると、 im@sparql を curl で叩いて、レスポンスの json をいい感じに整形して、その結果を slack の webhook にポストしている感じです。</p>\n<p>あとは circleci の parameters: で webhook url と icon とユーザ名を定義します。 $SLACK<em>WEB</em>HOOK になっている環境変数部分は CircleCI のページ上で設定します。</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/4684/1*BwrH3knlQ40Zsl6eSAXwEQ.png\"></p>\n<p>実際に使うときの .circleci/config.yml は下のようにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: 2.1\norbs:\n  todays-imas-idol: yutagoto/todays-imas-idol@0.2.1\n\njobs:\n  slack:\n    docker:\n    - image: ubuntu:18.04\n    steps:\n      - run:\n          command: |\n            apt-get update\n            apt-get install -y sudo\n      - todays-imas-idol/slack-notification-todays-imas-idol:\n          slack_username: CiecleCI\n          slack_icon: &quot;:ciecleci:&quot;\n\nworkflows:\n  main:\n    jobs:\n    - slack</code></pre></div>\n<p>orb コマンド(?)を実行するときにパラメータが設定できるので、上のように定義します。default が設定されているので、なくても動きます(たぶん)。</p>\n<p>っで実行した結果は、</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/3540/1*R8COJz7IPGa7ZrhXzePV_Q.png\"></p>\n<p>こんな感じになります。執筆当日(01/04)は誕生日アイドルがいないので null になってしまいました。 null のときに今日誕生日のアイドルはいません みたいなことは後日対応します。</p>\n<p>アイドルが複数人誕生日を迎えて出力が崩れてしまう可能性もなきにしもあらずなので、崩れたら修正します。。(おい)</p>\n<p>そんなこんな結局</p>\n<iframe src=\"https://medium.com/media/abf96dc8723995caf9d8f029c1aa6735\" frameborder=0></iframe>\n<p>です。</p>\n<p>いつもありがとうございます。 🙏</p>\n<h2>追記 2019/01/07</h2>\n<p>複数人のときやいないときの対応しました！</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2516/1*_Ch7F_qmOFHHSUVY5-m-2g.png\" alt=\"01/06のとき\"><em>01/06 のとき</em></p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2328/1*pnopk-yzcyJllxkh1qZ_8Q.png\" alt=\"01/07のとき\"><em>01/07 のとき</em></p>\n<p>if else を書いただけなんですけどね。</p>\n<h2>References</h2>\n<ul>\n<li>yutagoto/todays-imas-idol@0.2.1, <a href=\"https://circleci.com/orbs/registry/orb/yutagoto/todays-imas-idol\">https://circleci.com/orbs/registry/orb/yutagoto/todays-imas-idol</a></li>\n<li>YutaGoto/todays-imas-idol-orb, <a href=\"https://github.com/YutaGoto/todays-imas-idol-orb\">https://github.com/YutaGoto/todays-imas-idol-orb</a></li>\n<li>今日誕生日のアイドルを出力する CircleCI orb をつくったお話 — ごっちの日記 — Medium, <a href=\"https://medium.com/@gggooottto/%E4%BB%8A%E6%97%A5%E8%AA%95%E7%94%9F%E6%97%A5%E3%81%AE%E3%82%A2%E3%82%A4%E3%83%89%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8Bcircleci-orb%E3%82%92%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%9F%E3%81%8A%E8%A9%B1-fff413118a40\">https://medium.com/@gggooottto/%E4%BB%8A%E6%97%A5%E8%AA%95%E7%94%9F%E6%97%A5%E3%81%AE%E3%82%A2%E3%82%A4%E3%83%89%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8Bcircleci-orb%E3%82%92%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%9F%E3%81%8A%E8%A9%B1-fff413118a40</a></li>\n<li>Reusing Config — CircleCI, <a href=\"https://circleci.com/docs/2.0/reusing-config/\">https://circleci.com/docs/2.0/reusing-config/</a></li>\n<li>im@sparql, <a href=\"https://sparql.crssnky.xyz/imas/\">https://sparql.crssnky.xyz/imas/</a></li>\n</ul>","frontmatter":{"title":"今日誕生日のアイドルを取得するCircleCI Orbに、Slack通知機能を追加したお話","date":"January 04, 2019","description":"今日誕生日のアイドルを取得するCircleCI Orbに、Slack通知機能を追加したお話"}},"previous":{"fields":{"slug":"/20190101-2019でやりたいこととか/"},"frontmatter":{"title":"2019でやりたいこととか"}},"next":{"fields":{"slug":"/20190112-splatoon2のステージ情報を取得するコマンドを作っている/"},"frontmatter":{"title":"Splatoon2のステージ情報を取得するコマンドを作っている"}}},"pageContext":{"id":"4e8658e9-8041-51dc-9a76-0a7757be0c68","previousPostId":"7209aa99-398a-5a22-bc51-bf54d8faaf5c","nextPostId":"b6e50320-6013-5524-8831-0610741c0b32"}},"staticQueryHashes":["2137539840","2201837728"]}